#!/bin/sh

# Set perms
chown -hR root: /
chown -R user: /home/user

chmod 0755 -R /
chmod 0644 /etc/* /vuln.ko
chmod 0700 /root/
chmod 400 /root/flag
#chmod 0600 /root/*

# Mount points
mount -t devtmpfs none /dev
mount -t proc none /proc
mount -t sysfs none /sys

#mkdir -p /passwd
#mount -o ro /dev/sda /passwd

# Share
#mkdir -p /mnt/share
#mount -t 9p -o trans=virtio mountpoint /mnt/share -oversion=9p2000.L,posixacl,sync
#chmod 777 /mnt/share

# Insert module
insmod /vuln.ko

# sysctls
sysctl -q kernel.kptr_restrict=2

# Shell
cat /etc/issue
export ENV=/etc/profile
setsid cttyhack setuidgid 1000 sh

poweroff -f
